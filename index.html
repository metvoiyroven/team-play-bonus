<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Play Bonus</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –°—Ç–∏–ª—å –ø–æ–¥ —Ç–µ–º—É –¢–µ–ª–µ–≥—Ä–∞–º–∞ */
        body {
            font-family: sans-serif;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            text-align: center;
            padding: 20px;
        }
        .bonus-card {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }
        button {
            background: var(--tg-theme-button-color, #248bed);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <h1>Team Play Bonus üèÜ</h1>
    <div class="bonus-card">
        <p id="user-info">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...</p>
        <h2 id="balance">–ë–∞–ª–∞–Ω—Å: 0 BP</h2>
        <button id="claim-btn">–ü–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å</button>
    </div>

    <script type="module">
        // 1. –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï FIREBASE
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // –í–°–¢–ê–í–¨ –°–í–û–ò –î–ê–ù–ù–´–ï –ò–ó –í–ö–õ–ê–î–ö–ò FIREBASE (Project Settings -> Web App)
        const firebaseConfig = {
            apiKey: "AIzaSyBk4hzLYNl9C4V7SyBMUlGis23IJ8x5TDI",
            authDomain: "teamplaybonus.firebaseapp.com",
            projectId: "teamplaybonus",
            storageBucket: "teamplaybonus.firebasestorage.app",
            messagingSenderId: "968832925102",
            appId: "1:968832925102:web:675d627c0e0733dc595c3f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tg = window.Telegram.WebApp;

        tg.expand(); // –†–∞—Å–∫—Ä—ã—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        const user = tg.initDataUnsafe?.user;

        if (user) {
            document.getElementById('user-info').innerText = `–ò–≥—Ä–æ–∫: ${user.first_name}`;
            
            // –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ
            const userRef = doc(db, "players", user.id.toString());

            // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            async function updateDisplay() {
                const snap = await getDoc(userRef);
                if (snap.exists()) {
                    document.getElementById('balance').innerText = `–ë–∞–ª–∞–Ω—Å: ${snap.data().points} BP`;
                }
            }

            // –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–ü–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å"
            document.getElementById('claim-btn').onclick = async () => {
                await setDoc(userRef, {
                    name: user.first_name,
                    points: increment(10) // –î–æ–±–∞–≤–ª—è–µ–º 10 –æ—á–∫–æ–≤
                }, { merge: true });
                
                tg.HapticFeedback.notificationOccurred('success'); // –í–∏–±—Ä–∞—Ü–∏—è
                updateDisplay();
            };

            updateDisplay();
        } else {
            document.getElementById('user-info').innerText = "–ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram!";
        }
    </script>
</body>
</html>
